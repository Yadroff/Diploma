\subsection{Генерация \LaTeX--кода}

После сегментации мы имеем представление о том, как расположены абзацы в тексте, где расположены формулы и т.д. Теперь мы можем приступить к генерации \LaTeX--кода.
Будем отделять текст и с помощью алгоритмов $\textit{OCR (optical character recognition)}$. В частности, в данной работе для распознавания текста используется $Python$ библиотека $pytesseract$ \cite{pytesseract}, а для преобразования изображения формул в \LaTeX--код используется модель $LaTeX-OCR$ \cite{LaTeX-OCR}.

Для правильной работы моделей необходимо предоставлять им корректные данные: для распознавания текста на изображении не должно быть формул и наоборот. Для этого необходимо на основании имеющихся координат абзацев и координат формул разбить абзацы на подабзацы так, чтобы каждый подабзац содержал в себе либо текст, либо формулу.
На рисунке~\ref{latex_generate_input} приведен пример простого текста, содержащего математические формулы.

\begin{figure}
    \includegraphics[scale=0.75]{img/latex_generation/input.jpg}
    \caption{Пример входного текста}
    \label{latex_generate_input}
\end{figure}

После применения к тексту алгоритмов, он будет разбит на части, как показано на рисунке~\ref{latex_segmentation}. Зеленым цветом выделен текст, красным - формулы.

\begin{figure}
    \includegraphics[scale=0.75]{img/latex_generation/segmented.jpg}
    \caption{Разбиение текста, представленного на рисунке~\ref{latex_generate_input}}
    \label{latex_segmentation}
\end{figure}

Разбиение по строкам текста показано для наглядности. В действительности каждое разбиение является прямоугольником, который может содержать в себе несколько строк. Для этого ненужная часть верхних строк закрашивается белым цветом и не участвует в дальнейшем распознавании текста.

Теперь мы можем преобразовать исходный текст в \LaTeX--код. Формулы, находящиеся в тексте, будем выделять символом '\$', а находящиеся в отдельных абзацах формулы будем выделять через \textit{\textbackslash [ \ldots \textbackslash]}.

Для входного текста, представленного на рисунке~\ref{latex_generate_input}, будем иметь следующий \LaTeX--код, показанный на рисунке~\ref{latex_code}.

\begin{figure}
    \begin{lstlisting}[language={[LaTeX]Tex}]
    Вот небольшой пример текста с математическими формулами. Пусть $x$ и $y$ будут переменными, представляющими числа. Мы можем использовать эти переменные для описания различных математических выражений. Например, мы можем записать уравнение прямой в виде $y = mx + c$, где $m$ - это наклон прямой, а $c$ - это её точка пересечения с осью $y$.
            
    Давайте рассмотрим ещё один пример. Пусть у нас есть квадратное уравнение $ax^2 + bx + c = 0$. Его корни могут быть найдены с помощью формулы дискриминанта:
        
    \[
    D = b^2 - 4ac
    \]
        
    Если $D > 0$, то у уравнения два действительных корня $x_1$ и $x_2$, которые можно найти по формулам:
        
    \[
    x_1 = \frac{{-b + \sqrt{D}}}{{2a}}, \quad x_2 = \frac{{-b - \sqrt{D}}}{{2a}}
    \]
        
    Если $D = 0$, то у уравнения есть один действительный корень $x$, который находится по формуле:
        
    \[
    x = -\frac{b}{{2a}}
    \]
        
    Наконец, если $D < 0$, то у уравнения нет действительных корней, а только комплексные.
    \end{lstlisting}
    \caption{Листинг текста~\ref{latex_generate_input}}
    \label{latex_code}
\end{figure}

В данном примере не хватает преамбулы. Для этого сформируем ее из популярных пакетов \LaTeX. На рисунке~\ref{preambula} показан листинг преамбулы.

\begin{figure}
    \begin{lstlisting}[language={[LaTeX]Tex}]
    \documentclass{article}
    \usepackage[T2A]{fontenc} % Кодировка шрифта
    \usepackage[utf8]{inputenc} % Кодировка ввода
    \usepackage[english, russian]{babel} % Пакет для поддержки русского языка
    \usepackage{amsmath} % Для использования математических формул
    
    \begin{document}
    ...
    \end{document}
    \end{lstlisting}
    \caption{Листинг преамбулы документа}
    \label{preambula}
\end{figure}